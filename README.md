## Asthma Time Series Forecasting Project

This is the repository for the asthma time series forecasting project, in partnership with the Asthma Health Learning System (AHLS). The goal of this project is to develop, analyze, and compare three classes of time series algorithms to formulate and deploy an optimal forecasting algorithm that can predict daily, weekly, and quarterly patient hospitalizations admitted for asthma-related symptoms throughout the City of Cincinnati, Hamilton County, and the surrounding region. The three classes of models considered include the **A**uto **R**egressive **I**ntegrated **M**oving **A**verage (ARIMA) models, **E**xponential **T**rend **S**easonality models (ETS), and Prophet. The main work for this project has been collected in the [daily_asthma.R](https://github.com/colegasn/AHLS_forecast/blob/master/daily_asthma.R) file, with other files exploring various different avenues of the project (for example, using other variables, threshold analysis, and plots).

For each class of models, we first identify the best models in the class that fit daily asthma hospitalizations from 2016-2023 and justify the choice. Then, we train the best model of each class using data from 2016-2021 and then evaluate the model's performance by performing "rolling" predictions each day from January 1, 2022, to December 31, 2023. For each day's prediction, the model is trained using the latest available data (the most recent 365 days, by default) and then forecasted to predict the next day's asthma hospitalizations number. Then, the actual asthma hospitalization number is added to the training set, the oldest day's observation is dropped, and the model is then refitted again using the updated training data set. In essence, the process continually evolves and updates the model each day, simulating what it would be like in the real world if these models were applied in the real world - updating the model each day after observing the day's latest hospitalization number.

The format of the work in the [daily_asthma.R](https://github.com/colegasn/AHLS_forecast/blob/master/daily_asthma.R) file has been divided into several parts:

1.  After loading the R packages, the [asthma.xlsx](https://github.com/colegasn/AHLS_forecast/blob/master/data-raw/asthma.xlsx) file is loaded and formatted. Plots and summary statistics help the user to become familiar with the data and to understand its features.

2.  ARIMA models are explored and justified. Two custom functions are used to formulate the models and make predictions: [arima_fit.R](https://github.com/colegasn/AHLS_forecast/blob/master/ARIMA%20Functions/arima_fit.R) makes predictions from the current ARIMA model, [roll_arima.R](https://github.com/colegasn/AHLS_forecast/blob/master/ARIMA%20Functions/roll_arima.R) conducts rolling predictions of the ARIMA model by repeatedly using the `arima_fit()` function on data from January 1, 2022, to December 31, 2023. Predictions are saved in a data file to be used in Step 5.

3.  ETS models are explored and justified. Two custom functions are used to formulate the models and make predictions: [ets_fit.R](https://github.com/colegasn/AHLS_forecast/blob/master/ETS%20Functions/ets_fit.R) makes predictions from the current ETS model, [roll_ets.R](https://github.com/colegasn/AHLS_forecast/blob/master/ETS%20Functions/roll_ets.R) conducts rolling predictions of the ETS model by repeatedly using the `ets_fit()` function on data from January 1, 2022, to December 31, 2023. Predictions are saved in a data file to be used in Step 5.

4.  Prophet models are explored and justified. Prophet is a model that was developed at Facebook that is easily to implement and deply at scale. More information about Prophet can be found by clicking [here](https://facebook.github.io/prophet/). Two custom functions are used to formulate the models and make predictions: [prophet_fit.R](https://github.com/colegasn/AHLS_forecast/blob/master/Prophet%20Functions/prophet_fit.R) makes predictions from the current Prophet model, [roll_prophet.R](https://github.com/colegasn/AHLS_forecast/blob/master/Prophet%20Functions/roll_prophet.R) conducts rolling predictions of the Prophet model by repeatedly using the `prophet_fit()` function on data from January 1, 2022, to December 31, 2023. Predictions are saved in a data file to be used in Step 5.

5.  Predictions from January 1, 2022, to December 31, 2023, from the ARIMA, ETS, and Prophet model classes are read in and combined for evaluation. Error statistics (e.g., mean squared error, median absolute percentage error) and confidence interval coverage are used to judge the predictions.

6.  Predictions are evaluated based on the top 5% threshold. Dates where the top 5% of admissions forecasted using the upper 90% confidence interval boundary are compared to days where the top 5% of admissions were actually observed. This analysis examines the predictions based on the timing of when top admissions are expected.

7.  ROC curve analysis for the ARIMA, ETS, and Prophet predictions analyze the threshold sensitivity, specificity, and area under the curve (AUC) based on the 5% threshold set by clinicians. The 5% threshold is determined to identify days where a high number of asthma hospitalizations were observed. Positive predictive value (PPV) and negative predictive value (NPV) along with the misclassification rate, are also calculated.

Future anticipated work on this project includes the following topics:

1.  **Lookback Window**: Predictions are made based on a 365-day history of the most recent hospitalizations. We want to examine how the predictions change both within and across the model classes with different window sizes.
2.  **Pre-/Post-Covid**: We will compare the predictions from the three model classes on hospitalization rates based on the effects contributed by the COVID-19 pandemic. Using data from 2016-2018 and from 2020-2022, we will evaluate model performance by predicting hospitalizations on 2019 (before the pandemic) and on 2023 (during and after the pandemic) to see how the effects of COVID-19 affect model performance.
3.  **AQI**: We will compare predictions based on observed air quality index (AQI) to determine if there are correlations with air quality on hospitalization rates.
4.  **Quarterly**: The models will be reframed and evaluated based on predictions made on the quarterly level. Total number of admissions observed during quarter 1 (September-November), 2 (December-February), 3 (March-May), and 4 (June-August) will be aggregated and evaluated on a quarterly scale.
5.  **Weekly**: The models will be reframed and evaluted based on predictions made each week. For each date, we will use the three model classes (ARIMA, ETS, Prophet) to predict hospitalizations for the next 3 days, 7 days, 10 days, 14 days, and 28 days. The predictions for these various time frames will be compared to actual observed hospitalizations to evaluate model performance. This will demonstrate the use of the algorithm in a clinical setting for readiness and preparedness purposes.
